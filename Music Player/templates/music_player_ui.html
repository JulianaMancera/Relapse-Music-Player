<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vinyl Nostalgia Player</title>
    <link rel="website icon" type="png" href="vinyl.png">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: url('/static/shi.png') no-repeat center center fixed;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        .player {
            background: rgba(0, 0, 0, 0.6);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            color: #f0e6d2;
            width: 400px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            position: relative;
        }
        .vinyl {
            width: 200px;
            height: 200px;
            background: url('/static/vinyl.png') no-repeat center;
            background-size: contain;
            margin: 20px auto;
            position: relative;
            transition: transform 0.3s ease;
        }
        .spinning {
            animation: spin 4s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .controls {
            margin: 20px 0;
        }
        .controls button {
            background-color: #4a2c2a;
            border: none;
            color: #f0e6d2;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        .controls button:hover {
            background-color: #6f4e2e;
            transform: scale(1.1);
        }
        #songTitle {
            font-size: 1.5em;
            color: #ff6b81;
            margin: 15px 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        #progress {
            width: 100%;
            height: 5px;
            background: #a3e4d7;
            margin: 10px 0;
            cursor: pointer;
        }
        #volume {
            width: 100px;
            margin: 10px auto;
        }
        #addMusic {
            margin-top: 20px;
        }
        #addMusic input {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #a3e4d7;
            background: rgba(163, 228, 215, 0.2);
            color: #f0e6d2;
            width: 70%;
        }
        #addMusic button {
            padding: 8px 15px;
            background-color: #4a2c2a;
            border: none;
            border-radius: 5px;
            color: #f0e6d2;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #addMusic button:hover {
            background-color: #6f4e2e;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="player">
        <h2>Vinyl Nostalgia Player</h2>
        <div class="vinyl" id="vinylDisc"></div>
        <div id="songTitle">No song playing</div>
        <div class="controls">
            <button onclick="prev()">Previous</button>
            <button onclick="play()">Play</button>
            <button onclick="pause()">Pause</button>
            <button onclick="stop()">Stop</button>
            <button onclick="next()">Next</button>
        </div>
        <input type="range" id="progress" min="0" max="100" value="0">
        <input type="range" id="volume" min="0" max="1" step="0.1" value="0.5">
        <div id="addMusic">
            <input type="text" id="newSong" placeholder="Enter song path or name">
            <button onclick="addSong()">Add Song</button>
        </div>
    </div>

    <script>
        let currentTrack = 0;
        let playlist = [];
        let audio = new Audio();
        let isPlaying = false;
        const vinyl = document.getElementById('vinylDisc');
        const progress = document.getElementById('progress');
        const volume = document.getElementById('volume');

        function updatePlaylist(newPlaylist) {
            playlist = newPlaylist;
            if (playlist.length > 0) {
                document.getElementById('songTitle').textContent = `Playing: ${playlist[currentTrack]}`;
                audio.src = `/music/${playlist[currentTrack]}`;
            }
        }

        function play() {
            if (playlist.length > 0 && !isPlaying) {
                audio.play();
                vinyl.classList.add('spinning');
                isPlaying = true;
                document.getElementById('songTitle').textContent = `Playing: ${playlist[currentTrack]}`;
            }
        }

        function pause() {
            if (isPlaying) {
                audio.pause();
                vinyl.classList.remove('spinning');
                isPlaying = false;
                document.getElementById('songTitle').textContent += " (Paused)";
            }
        }

        function stop() {
            audio.pause();
            audio.currentTime = 0;
            vinyl.classList.remove('spinning');
            isPlaying = false;
            document.getElementById('songTitle').textContent = "Stopped";
        }

        function next() {
            if (currentTrack < playlist.length - 1) currentTrack++;
            loadTrack();
            if (isPlaying) play();
        }

        function prev() {
            if (currentTrack > 0) currentTrack--;
            loadTrack();
            if (isPlaying) play();
        }

        function loadTrack() {
            audio.src = `/music/${playlist[currentTrack]}`;
            document.getElementById('songTitle').textContent = `Playing: ${playlist[currentTrack]}`;
            fetch('/next', { method: 'POST' }).then(() => {}); // Sync with server
        }

        function addSong() {
            const newSong = document.getElementById('newSong').value;
            if (newSong && !playlist.includes(newSong)) {
                fetch('/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ song: newSong })
                }).then(response => response.json()).then(data => {
                    playlist = data.playlist;
                    document.getElementById('newSong').value = '';
                    console.log(`Added: ${newSong}`);
                });
            }
        }

        audio.addEventListener('timeupdate', () => {
            if (!audio.paused) {
                const progressPercent = (audio.currentTime / audio.duration) * 100;
                progress.value = progressPercent;
            }
        });

        progress.addEventListener('input', () => {
            const seekTime = (progress.value / 100) * audio.duration;
            audio.currentTime = seekTime;
        });

        volume.addEventListener('input', () => {
            audio.volume = volume.value;
        });

        updatePlaylist(['cause u have to.mp3', 'payphone.mp3']);
    </script>
</body>
</html>